import{d as Y,r as _,H as j,D as F,a as g,k as E,w as a,a0 as l,Z as v,M as S,N,c as $,O as G,a1 as O,a5 as q,j as h,a6 as B,e as A,a3 as H,a4 as J,o as Z,f as T}from"./index-94018045.js";import{v as K}from"./index-35e2db26.js";import{E as Q,a as W,b as X}from"./el-image-viewer-08300ac1.js";import"./el-tag-78212571.js";import"./el-popper-7c706a0b.js";import{E as D}from"./el-button-085c9972.js";import{E as ee,a as te,b as le,c as ae}from"./el-form-item-35ae95d2.js";import{E as L,g as oe,s as se,a as z,d as ne,b as re,p as ie}from"./game-28d300e0.js";import{_ as ue}from"./_plugin-vue_export-helper-c27b6911.js";import"./focus-trap-08676984.js";import"./use-form-item-4426b945.js";const de=h("i",{class:"el-icon-plus"},null,-1),me=Y({__name:"game-detail",setup(V,{expose:w}){_([]);const m=(n,t)=>{e.value.row.logo=t[0].raw,console.log(e.value.row.logo),console.log(typeof e.value.row.logo=="object")},f=(n,t,u)=>{/^\d{4}-\d{2}-\d{2}$/.test(t)?u():u(new Error("日期格式必须为YYYY-MM-DD"))},d=j({title:[{required:!0,message:"请输入赛事名称",trigger:"blur"}],introduction:[{required:!0,message:"请输入赛事介绍",trigger:"blur"}],start_time:[{required:!0,message:"请输入开始时间",trigger:"blur"},{validator:f,trigger:"blur"}],end_time:[{required:!0,message:"请输入结束时间",trigger:"blur"},{validator:f,trigger:"blur"}],logo:[{required:!1,message:"请选择赛事logo",trigger:"blur"}]}),c=_(!1),e=_({isView:!1,title:"",row:{title:"",introduction:"",information:[],time_node:[{type:"",value:""}],start_time:"",end_time:"",logo:null},api:""}),b=()=>{console.log(e.value.row.time_node),e.value.row.time_node.push({type:"",value:""})},x=()=>{e.value.row.time_node.pop()},k=n=>{n&&(e.value=n),c.value=!0},y=_(),s=()=>{y.value.validate(async n=>{if(n)try{const t=new FormData;t.append("title",e.value.row.title),t.append("introduction",e.value.row.introduction),(o.value||typeof e.value.row.logo=="object")&&t.append("logo",e.value.row.logo),t.append("time_node",JSON.stringify(e.value.row.time_node)),t.append("start_time",e.value.row.start_time),t.append("end_time",e.value.row.end_time),await e.value.api(t),B.success({message:`${e.value.title}比赛成功！`}),e.value.getTableList(),c.value=!1}catch(t){console.log(t)}})},o=F(()=>e.value.title==="新增");return F(()=>e.value.title==="编辑"),w({acceptParams:k}),(n,t)=>{const u=L,i=ee,p=D,C=te,M=Q,P=le,R=ae;return g(),E(R,{modelValue:c.value,"onUpdate:modelValue":t[5]||(t[5]=r=>c.value=r),"destroy-on-close":!0,size:"450px",title:`${e.value.title}比赛`},{footer:a(()=>[l(p,{onClick:t[4]||(t[4]=r=>c.value=!1)},{default:a(()=>[v(" 取消 ")]),_:1}),S(l(p,{type:"primary",onClick:s},{default:a(()=>[v(" 确定 ")]),_:1},512),[[N,!e.value.isView]])]),default:a(()=>[l(P,{ref_key:"ruleFormRef",ref:y,"label-width":"100px","label-suffix":" :",rules:d,disabled:e.value.isView,model:e.value.row,"hide-required-asterisk":e.value.isView},{default:a(()=>[l(i,{label:"赛事名称",prop:"title"},{default:a(()=>[l(u,{modelValue:e.value.row.title,"onUpdate:modelValue":t[0]||(t[0]=r=>e.value.row.title=r),placeholder:"输入赛事名称"},null,8,["modelValue"])]),_:1}),l(i,{label:"赛事介绍",prop:"introduction"},{default:a(()=>[l(u,{modelValue:e.value.row.introduction,"onUpdate:modelValue":t[1]||(t[1]=r=>e.value.row.introduction=r),placeholder:"输入赛事介绍"},null,8,["modelValue"])]),_:1}),l(i,{label:"开始时间",prop:"start_time"},{default:a(()=>[l(u,{modelValue:e.value.row.start_time,"onUpdate:modelValue":t[2]||(t[2]=r=>e.value.row.start_time=r),placeholder:"输入开始时间"},null,8,["modelValue"])]),_:1}),l(i,{label:"结束时间",prop:"end_time"},{default:a(()=>[l(u,{modelValue:e.value.row.end_time,"onUpdate:modelValue":t[3]||(t[3]=r=>e.value.row.end_time=r),placeholder:"输入结束时间"},null,8,["modelValue"])]),_:1}),(g(!0),$(G,null,O(e.value.row.time_node,(r,I)=>(g(),$("div",{key:I},[l(i,{label:`时间节点 ${I+1}`},{default:a(()=>[l(u,{modelValue:r.type,"onUpdate:modelValue":U=>r.type=U,placeholder:"请输入时间类型"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),l(i,null,{default:a(()=>[l(u,{modelValue:r.value,"onUpdate:modelValue":U=>r.value=U,placeholder:"请输入时间值"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]))),128)),e.value.isView?q("",!0):(g(),E(i,{key:0},{default:a(()=>[l(p,{type:"primary",onClick:b},{default:a(()=>[v("添加节点")]),_:1}),l(p,{onClick:x},{default:a(()=>[v("删除节点")]),_:1})]),_:1})),e.value.isView?q("",!0):(g(),E(i,{key:1,label:"赛事logo",prop:"logo"},{default:a(()=>[l(C,{action:"' '","list-type":"picture-card",limit:1,"show-file-list":"","auto-upload":!1,"on-change":m,multiple:""},{default:a(()=>[de]),_:1})]),_:1})),S(l(i,{label:"logo"},{default:a(()=>[l(M,{style:{width:"100px",height:"100px"},src:e.value.row.logo,fit:"cover"},null,8,["src"])]),_:1},512),[[N,e.value.isView]])]),_:1},8,["rules","disabled","model","hide-required-asterisk"])]),_:1},8,["modelValue","title"])}}});const ce=V=>(H("data-v-57136257"),V=V(),J(),V),pe={class:"search-input"},_e={class:"input"},ve=ce(()=>h("span",{style:{"word-break":"keep-all","line-height":"35px"}},"输入搜索：",-1)),fe={__name:"search",emits:{input:{type:String,default:null}},setup(V,{emit:w}){const m=_("");return(f,d)=>{const c=L,e=D;return g(),$("div",pe,[h("div",_e,[ve,l(c,{modelValue:m.value,"onUpdate:modelValue":d[0]||(d[0]=b=>m.value=b),class:"input",size:"large",placeholder:"输入搜索","suffix-icon":f.Search},null,8,["modelValue","suffix-icon"])]),A(f.$slots,"select",{},void 0,!0),l(e,{onClick:d[1]||(d[1]=b=>w("input",m.value))},{default:a(()=>[v("查询")]),_:1})])}}},ge=ue(fe,[["__scopeId","data-v-57136257"]]),we={class:"container"},Ve={class:"form"},Ie={__name:"game",setup(V){const w=_([]),m=_(!1);_("");const f=s=>{s.results.forEach(o=>{o.time=o.start_time+"至"+o.end_time})},d=async(s,o)=>{m.value=!0;const{data:n}=await oe();f(n),console.log(n),w.value=n.results,m.value=!1},c=async s=>{if(!s)d();else{const{data:o}=await se({text:s});f(o),w.value=o.results}};Z(()=>{d()});const e=async s=>{const{data:o}=await z(s.id);console.log(o),y("查看",o)},b=async s=>{const{data:o}=await z(s.id);console.log(o),y("编辑",o)},x=async s=>{await ne(s.id),B.success({message:"删除比赛成功"})},k=_(null),y=(s,o={title:"",introduction:"",information:[],time_node:[],start_time:"",end_time:""})=>{var t;const n={title:s,row:o,isView:s==="查看",api:s==="新增"?re:s==="编辑"?ie(o.id):void 0,getTableList:d};console.log(n),(t=k.value)==null||t.acceptParams(n)};return(s,o)=>{const n=X,t=D,u=W,i=K;return g(),$(G,null,[h("div",we,[h("div",Ve,[l(T(ge),{onInput:c})]),S((g(),E(u,{data:w.value,style:{width:"100%"}},{default:a(()=>[l(n,{label:"赛事名称",prop:"title"}),l(n,{label:"赛事时间",prop:"time"}),l(n,{align:"right"},{header:a(()=>[l(t,{onClick:o[0]||(o[0]=p=>y("新增"))},{default:a(()=>[v("新建赛事")]),_:1})]),default:a(p=>[l(t,{size:"small",onClick:C=>e(p.row)},{default:a(()=>[v("查看")]),_:2},1032,["onClick"]),l(t,{size:"small",onClick:C=>b(p.row)},{default:a(()=>[v("编辑")]),_:2},1032,["onClick"]),l(t,{size:"small",type:"danger",onClick:C=>x(p.row)},{default:a(()=>[v("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[i,m.value]])]),l(T(me),{ref_key:"drawerRef",ref:k},null,512)],64)}}};export{Ie as default};
